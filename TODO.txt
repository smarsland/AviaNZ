
# TODO for AviaNZ

SM:

# Check both human classify segments with showAllPages
And put the flag in self.config
    #Done, but does not work in some cases (e.g. show blank spectrogram)

*** Exporter problem

The classify options only work for the 5 minute sections.
    # I think done for both, but needs checking
Problem is that otherwise need to load spectrograms -- then must sort segments

Bars for playing don't work after 1st 'page'
    # Done, but check
    play visible and play segment are working in all pages.
    but it doesn't work in the first page too (bandlimited play)

Classify segments

Wavelet denoising with best tree?

Work out how to make old wavelet method produce too many segments

Make a new method (not inside Segmentation):
    (1) Perform segmentation using at least one of old wavelet method and any other segmenter, possibly multiple options
    # Partly done, (FIR + median clip). Add in wavelets.
    # And it does need parameters
    (2) Combine the segments as appropriate
    # Two versions are done. Opens it out so far, no max. Either with or without envelopes kept.
    (3) Perform classification on each segment using at least one of wavelet energies, Raven feature, MFCC, LPC, fundamental freq
    # To be done (ready to modify wavelet segmentation part)

Plot the wavelet energy for noise, crickets, calls, etc.
    Suppress the noise nodes, reconstruct -- what happens?
Parallel process the segmenters

Update the manual

Video of using

get name from standard files and use it
    # Name bit is done, not yet used

On Windows: check if in HumanClassify1, playing second is different to first
    # Apparently OK

Put freq axis tight option somewhere better
    # DONE

For HumanClassify2 errors
    -> they are currently just deleted.
    Better is to remove them, but to save them and then after all have been processed,
    use HumanClassify1 to get labels for them, save them somewhere and reuse for more training
    There needs to be an option to not do this though :)
    # DONE

NP:

*** Ensure saving of the config file and the data files on Windows

Test the idea of using the wavelet nodes with either
    (a or b or c) and not (d or e)
    (a and (b or c))
    or maybe both :)
    Will have to count the number of times each occurs
    Idea is to reduce (i) misclassifications, (2) crickets, (3) wide-band clicks, (4) rain

Username in the status bar
#Done

Make the Manual Seg produce the excel files (Export segmentation option in menu)
And put all the three excel files into 1 on 3 sheets
#Done

Make a pretty (simple) version of the Process File dialog
#Done, but seems like I have to add more features to this interface
    (1) add a help (manual)
    (2) Check if the folder has been processed halfway in a previous go find the new starting point rather than starting from first file
    (3) Train wavelet to detect wind and rain so that the user can run this detector to see the proportion of useful data
        (e.g. SIPO dataset is rainy, so almost all the recordings turned out to be positive due to rain)

Enable parameter setting

Paper!

Raven features

Denoising experiments
    -> short time better than long?
    -> denoise only segments
    -> compare python and matlab

Segmentation experiments
    -> like thesis but better :)
    -> paper

(1) Minor bugs and extensions

    SM: Get the time from the file name (if standard) and use it to put day or night birds first

    NP: Read mp3 files
# SM: pysox


    NP: Make it possible to change parameters (look into pyqtgraph ParameterTree)

    ??: What to do with stereo sound? How about consistent sample rates?

	Interface --> Change spectrogram parameters --> add visible frequency range e.g. from:0 to:8000

	Update the status bar when auto saving the annotation? Users want to know/confirm.

    NP: Make play sounds play the denoised version after denoising
# This seems to be complicated with undo etc. Still thinking whats the best way to do it,
  can easily add a separate button to play denoised but not nice. I fixed the plotting problem though.

	NP: Stop loading the file when choose to cancel the progress bar
# Removed the cancel button for now. otherwise have to unroll what happened inside the loadFile when the user cancel it.

	File list dock becomes frozen - one was experiencing this. Had to restart the program.
	    # Can we reproduce it?

Isa:
    (1) save problem -- doesn't always seem to save segments?
    (2) make the config file somewhere you can write it
    (3) have a 'take screenshot' option

(2) Memory management
    NP: It's a pain, but needs thinking about and then doing
    Could just split the file into shorter pieces? 
    Split files into 5 minute segments or whatever or look into paging

(3) Denoising, Wavelets and Segmentation
    Make denoising work
        Is there something wrong? No
        *** How long should a denoise piece be? Depends
	(1) Compare with matlab for long files: Almost identical results
	(2) *** Compare with making wavelet trees on shorter pieces
	(3) *** Denoise the segments separately


    NP: Fully integrate wavelet seg into program
    NP: We actually want Kiwi (M) and Kiwi (F), and need to get all the ruru calls
    NP: Want to have some form of machine learning
		(1) decision tree
		(2) MLP
		(3) SVM
		(4) boosting
    SM: And need to think about the 95% confidence thing a lot more
    SM: Add in the Check Segments 2 bit for this, and actually process the results!

    SM: Make the segmentations work fully
        Get the minimum time of a segment parameter sorted
        Work out how to combine the methods, particularly, spot overlaps in segments and combine them
        Work out parameters and how to set them
        Remove cross-correlation? Or just improve?

    Both: Think about nice ways to train a new wavelet filter
		And get the whole workflow sorted for it

    Use intensity of colour to encode certainty?

(4) Features
    Use the wavelets
    Finish the Raven features
    Add MFCC (nearly done)
    And whatever else seems interesting

    More on fundamental frequency
        smoothing?
        harvest or bana (yaapt was awful)
    Shape metrics

(5) Learning
    Standard methods
        MLP
        Decision tree
        Boosting
        SVM
    LSTM or GRU

    HMM to string syllables together

(6) Other
    Think more about the spectrogram inversion
        If it works --> Stu's bats
        Denoise the spectrogram fully (median filter, smoothing, consider grab-cut)

    Any necessary database or metadata things?

    Bats do keep on coming up...

    Generative noise model
